listmap.clear();
String[] lines = _response.split("\n");
HashMap<String, Object> _item = null;

for (int i = 0; i < lines.length; i++) {
    String line = lines[i].trim();
    
    if (line.startsWith("#EXTINF")) {
        _item = new HashMap<>();
        
        // 1. Extract Channel Name
        if (line.contains(",")) {
            _item.put("name", line.substring(line.lastIndexOf(",") + 1).trim());
        }
        
        // 2. Extract Logo
        if (line.contains("tvg-logo=\"")) {
            _item.put("image", line.split("tvg-logo=\"")[1].split("\"")[0]);
        }
        
        // 3. Extract Group Title
        if (line.contains("group-title=\"")) {
            _item.put("group", line.split("group-title=\"")[1].split("\"")[0]);
        } else {
            _item.put("group", "General");
        }
    } 
    // 4. Capture Clearkey License
    else if (line.startsWith("#KODIPROP:inputstream.adaptive.license_key=")) {
        if (_item != null) {
            _item.put("clearkey", line.split("=")[1].trim());
        }
    }
    // 5. Capture Cookie from #EXTHTTP JSON (as seen in Image 7)
    else if (line.startsWith("#EXTHTTP:")) {
        if (_item != null) {
            try {
                String jsonPart = line.substring(line.indexOf(":") + 1).trim();
                org.json.JSONObject jo = new org.json.JSONObject(jsonPart);
                if (jo.has("cookie")) {
                    _item.put("cookie", jo.getString("cookie"));
                }
            } catch (Exception e) {
                _item.put("cookie", "");
            }
        }
    }
    // 6. Capture the MPD URL
    else if (line.length() > 0 && !line.startsWith("#")) {
        if (_item != null) {
            _item.put("url", line);
            listmap.add(_item);
            _item = null; // Reset for next channel
        }
    }
}

// Refresh GridView
gridview1.setAdapter(new Gridview1Adapter(listmap));
((BaseAdapter)gridview1.getAdapter()).notifyDataSetChanged();
progressbar1.setVisibility(View.GONE);
